C51 COMPILER V9.00   TIMER                                                                 09/04/2015 16:30:54 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Receiver\timer.c LARGE BROWSE INCDIR(.\Receiver) DEBUG OBJECTEXTEND PRINT(.
                    -\timer.lst) TABS(2) OBJECT(timer.obj)

line level    source

   1          #include "timer.h"
   2          #include "key.h"
   3          #include "menu.h"
   4          
   5          unsigned char await_number = 0;      //待机时刻计算50MS次数变量
   6          unsigned char await_number_table = 0;//0.5秒标志变量
   7          
   8          unsigned char main_press_time_table = 0;//main计算时间变量跟标志位
   9          unsigned char main_press_time = 0;
  10          
  11          void Init_Timer0(void)
  12          {
  13   1        TMOD |= 0x01;   //使用模式1，16位定时器，使用"|"符号可以在使用多个定时器时不受影响  
  14   1        TH0 = (65536 - TIMER50MS) >> 8; //重新赋值 5ms
  15   1        TL0 = (65536 - TIMER50MS) & 0xff;
  16   1        EA = 1;            //总中断打开
  17   1        ET0 = 1;           //定时器中断打开
  18   1        TR0 = 1;           //定时器开关打开
  19   1      }
  20          
  21          void Timer0_isr(void) interrupt 1
  22          {
  23   1        unsigned char func_index_temp = 0;
  24   1        TF0 = 0;
  25   1        TH0 = (65536 - TIMER50MS) >> 8;     //重新赋值 50ms
  26   1        TL0 = (65536 - TIMER50MS) & 0xff;
  27   1        func_index_temp = return_func_index();
  28   1        if (func_index_temp == MENU_STANDBY || func_index_temp == TWO_MENU_F0_YEAR || func_index_temp == TWO_MENU
             -_F0_MOUTH 
  29   1          || func_index_temp == TWO_MENU_F0_DAY || func_index_temp == TWO_MENU_F0_WEEK || func_index_temp == TWO_M
             -ENU_F0_HOUR
  30   1          || func_index_temp == TWO_MENU_F0_MINUTE )
  31   1        {
  32   2          await_number++;
  33   2          if (await_number == 10)
  34   2          {
  35   3            await_number_table++;
  36   3            await_number = 0;
  37   3          }
  38   2          if (await_number_table >= 4)//确保程序正确延时
  39   2          {
  40   3            await_number_table = 0;
  41   3          }   
  42   2        }
  43   1      
  44   1        if (main_press_time_table == 1) //菜单键按下时间标志
  45   1        {
  46   2          main_press_time++;      //计算菜单键按下时间长度变量
  47   2        }
  48   1      
  49   1      }
  50          
  51          unsigned char return_await_number_table(void) //返回await_number_table变量的值
  52          {
C51 COMPILER V9.00   TIMER                                                                 09/04/2015 16:30:54 PAGE 2   

  53   1        unsigned char await_number_table_temp=0;
  54   1        await_number_table_temp = await_number_table;
  55   1        return await_number_table_temp;
  56   1      }
  57          
  58          void set_await_number_table(unsigned char temp) //设置await_number_table变量的值
  59          {
  60   1        await_number_table = temp;
  61   1      }
  62          
  63          void set_main_press_time_table(unsigned char temp) //设置main_press_time_table变量的值
  64          {
  65   1        main_press_time_table = temp;
  66   1      }
  67          
  68          unsigned char return_main_press_time(void)
  69          {
  70   1        unsigned char temp = 0;
  71   1        temp = main_press_time;
  72   1        return temp;
  73   1      }
  74          
  75          void clear_main_press_time(void)
  76          {
  77   1        main_press_time = 0;
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    189    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
