C51 COMPILER V9.00   KEY                                                                   09/03/2015 12:18:01 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Receiver\key.c LARGE BROWSE INCDIR(.\Receiver) DEBUG OBJECTEXTEND PRINT(.\k
                    -ey.lst) TABS(2) OBJECT(key.obj)

line level    source

   1          #include "key.h"
   2          #include "usart.h"
   3          
   4          unsigned char func_index = 0; //多级菜单索引变量
   5          void(*current_operation_index)();// 多级菜单函数指针
   6          
   7          key_table code table[100] =
   8          {
   9            { 0, 0, 0, 0, 0, (*delay10ms) },
  10          };
  11          
  12          unsigned int KeyScan(void)  //Keyboard scan function
  13          {
  14   1        unsigned int Val = 0;
  15   1        HKeyPort |= 0x1f;//Row height
  16   1        LKeyPort &= 0x07;
  17   1        if ((HKeyPort & 0x1f) != 0x1f)//Press button
  18   1        {
  19   2          delay10ms();  //Remove jitter
  20   2          if ((HKeyPort & 0x1f) != 0x1f)   //Press button
  21   2          {
  22   3            HKeyPort |= 0x1f; //检测第一列
  23   3            LKeyPort |= 0xf8;
  24   3            LKeyPort &= 0x7f;
  25   3            if ((HKeyPort & 0x1f) != 0x1f)
  26   3            {
  27   4              //  return_standby_time=0;
  28   4              //  sound_table=1;
  29   4              Val = HKeyPort & 0x1f;
  30   4              Val <<= 8;
  31   4              Val += (LKeyPort & 0xf8);
  32   4              if (Val == 0x1e78)
  33   4              {
  34   5                //    main_press_time=0;
  35   5                //    main_press_time_table=1;
  36   5              }
  37   4              while ((HKeyPort & 0x1f) != 0x1f);
  38   4              delay10ms();
  39   4              while ((HKeyPort & 0x1f) != 0x1f);
  40   4              //  main_press_time_table=0;
  41   4              return Val;
  42   4            }
  43   3          }
  44   2        }
  45   1        return 0x0fff;
  46   1      }
  47          
  48          unsigned char KeyDecoder(void)
  49          {
  50   1        unsigned int key_val = 0;
  51   1      
  52   1        key_val = KeyScan();
  53   1      #if 0   
                if (key_val == 0x0fff) /*do not key press*/
C51 COMPILER V9.00   KEY                                                                   09/03/2015 12:18:01 PAGE 2   

                {
                  /*sjz 有注册管理器标志*/
                  if (register_manager == 1)
                  {
              
                    if (func_index == FUNC_STANDBY)
                    {
                      if ((old2_RF_RECE_REG[2] & 0x0f) == 0x01)
                      {
                        accumulate_decoder++;
                      }
                      else
                      {
                        accumulate_decoder = 0;
                      }
                      if (accumulate_decoder>10)
                      {
                        accumulate_50ms = 20;
                        accumulate_decoder = 0;
                      }
                    }
                    register_manager = 0;
                    switch (old2_RF_RECE_REG[2] & 0x0f)
                    {
                    case 0x01:key_val = 0x1778; break;
                    case 0x02:key_val = 0x1b78; break;
                    case 0x04:key_val = 0x1d78; break;
                    case 0x08:key_val = 0x1e78; break;
                    default:break;
                    }
                  }
                }
              #endif   
  88   1      
  89   1      #ifdef DEBUG
  90   1        if (key_val != 0x0fff)
  91   1        uart_printf("key_val is %x .\r\n", key_val); //测试按键键值
  92   1      #endif
  93   1        switch (key_val)
  94   1        {
  95   2        case 0x1778:return KEY_RETURN; break;//1 按下相应的键显示相对应的码值
  96   2        case 0x1d78:return KEY_DOWN; break;//2  
  97   2        case 0x1b78:return KEY_UP; break;//4
  98   2        case 0x1e78:return KEY_FUNC; break;//5 按下相应的键显示相对应的码值
  99   2        default:return 0xff; break;
 100   2        }
 101   1      }
 102          
 103          void delay10ms(void)   //误差 -0.054253472222us
 104          {
 105   1        unsigned char a, b, c;
 106   1        for (c = 4; c>0; c--)
 107   1        for (b = 52; b>0; b--)
 108   1        for (a = 220; a>0; a--);
 109   1        _nop_();  //if Keil,require use intrins.h
 110   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    231    ----
   CONSTANT SIZE    =    818    ----
   XDATA SIZE       =      4       4
C51 COMPILER V9.00   KEY                                                                   09/03/2015 12:18:01 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
